<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="card">
    <h2>ðŸ“¦ Database GitHub</h2>

    <input id="number" placeholder="Nomor user">
    <button onclick="addUser()">Add</button>
    <button onclick="delUser()">Delete</button>
    <button onclick="delAll()">Delete All</button>

    <h3>ðŸ“„ Isi Database</h3>
    <pre id="db">Loading...</pre>

    <button class="danger" onclick="clearStorage()">Reset Config</button>
  </div>

  <script>
  const token = localStorage.getItem('token') || sessionStorage.getItem('token');
const repo = localStorage.getItem('repo') || sessionStorage.getItem('repo');
const file = localStorage.getItem('file') || sessionStorage.getItem('file');
const raw = localStorage.getItem('raw') || sessionStorage.getItem('raw');

const apiUrl = `https://api.github.com/repos/${repo}/contents/${file}`;

const headers = {
  Authorization: `token ${token}`,
  Accept: 'application/vnd.github.v3+json'
};

async function loadDB() {
  const res = await fetch(apiUrl, { headers });
  const json = await res.json();
  const content = JSON.parse(atob(json.content));
  window.sha = json.sha;
  window.db = content.dbnya || [];
  document.getElementById('db').textContent = window.db.join('\n');
}

async function updateDB(newDB, msg) {
  await fetch(apiUrl, {
    method: 'PUT',
    headers,
    body: JSON.stringify({
      message: msg,
      content: btoa(JSON.stringify({ dbnya: newDB }, null, 2)),
      sha: window.sha
    })
  });
  loadDB();
}

function addUser() {
  if (!db.includes(number.value)) {
    db.push(number.value);
    updateDB(db, `add ${number.value}`);
  }
}

function delUser() {
  updateDB(db.filter(x=>x!==number.value), `delete ${number.value}`);
}

function delAll() {
  updateDB([], 'delete all');
}

function clearStorage() {
  localStorage.clear();
  sessionStorage.clear();
  location.href = 'index.html';
}
    loadDB();
  </script>
</body>
</html>