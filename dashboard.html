<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="particles"></div>
  <div class="card">
    <h2>ðŸ“¦ Database GitHub</h2>

    <input id="number" placeholder="Nomor user">
    <button onclick="addUser()">Add</button>
    <button onclick="delUser()">Delete</button>
    <button onclick="delAll()">Delete All</button>

    <h3>ðŸ“„ Isi Database</h3>
    <pre id="db">Loading...</pre>

    <button class="danger" onclick="clearStorage()">Reset Config</button>
  </div>
  <script>
document.addEventListener('DOMContentLoaded', function () {
    particleground(document.getElementById('particles'), {
      dotColor: '#999999',
      lineColor: '#777777',
      minSpeedX: 0.1,
      maxSpeedX: 0.3,
      minSpeedY: 0.1,
      maxSpeedY: 0.3,
      density: 10000,
      particleRadius: 3,
    });
  }, false);
  </script>
  <script>
  function showNotif(teks, tipe="success") {
    const notif = document.getElementById("notification");
    const ntext = document.getElementById("notification-text");

    notif.classList.remove("success", "error");
    notif.classList.add(tipe);
    
    ntext.textContent = teks;
    notif.classList.add("show");

    setTimeout(() => notif.classList.remove("show"), 3000);
}

function showLoading() {
    const el = document.getElementById("loading-bg");
    el.style.display = "flex"; // Aktifkan flex saat dipanggil
}

function hideLoading() {
    document.getElementById("loading-bg").style.display = "none";
}
async function LoadScreen() {
    showLoading();
    await new Promise(resolve => setTimeout(resolve, 1500));
    hideLoading();
    }
const token = localStorage.getItem('token') || sessionStorage.getItem('token');
const repo = localStorage.getItem('repo') || sessionStorage.getItem('repo');
const file = localStorage.getItem('file') || sessionStorage.getItem('file');

const apiUrl = `https://api.github.com/repos/${repo}/contents/${file}`;

const headers = {
  Authorization: `token ${token}`,
  Accept: 'application/vnd.github.v3+json'
};

async function loadDB() {
  const res = await fetch(apiUrl, { headers });
  const json = await res.json();
  const content = JSON.parse(atob(json.content));
  window.sha = json.sha;
  window.db = content.dbnya || [];
  document.getElementById('db').textContent = window.db.join('\n');
}

async function updateDB(newDB, msg) {
  await fetch(apiUrl, {
    method: 'PUT',
    headers,
    body: JSON.stringify({
      message: msg,
      content: btoa(JSON.stringify({ dbnya: newDB }, null, 2)),
      sha: window.sha
    })
  });
  loadDB();
}

function addUser() {
  if (!db.includes(number.value)) {
    await LoadScreen()
    showNotif(`Succes Add ${number.value}`, "success")
    db.push(number.value);
    updateDB(db, `add ${number.value}`);
  }
}

function delUser() {
  await LoadScreen()
  showNotif(`Succes Delete ${number.value}`, "success")
  updateDB(db.filter(x=>x!==number.value), `delete ${number.value}`);
}

function delAll() {
  await LoadScreen()
  showNotif("Succes Delete All", "success")
  updateDB([], 'delete all');
  
}

function clearStorage() {
  LoadScreen()
  localStorage.clear();
  sessionStorage.clear();
  location.href = 'index.html';
}
    loadDB();
  </script>
</body>
</html>